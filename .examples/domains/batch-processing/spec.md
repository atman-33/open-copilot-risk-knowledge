# バッチ処理ドメイン仕様

## 概要

このドメインは、非同期処理、スケジュール済みジョブ、CSVインポート/エクスポートを含む大量データ操作をカバーしています。

## コアコンポーネント

### 1. ジョブキューシステム

- メッセージキューを使用したバックグラウンドジョブプロセッサー
- 優先度ベースのジョブスケジューリング
- 指数バックオフによる再試行メカニズム

### 2. サポートされる操作

| 操作 | 説明 | 一般的なサイズ |
|-----------|-------------|--------------|
| CSVインポート | ユーザー/製品データの大量インポート | 最大10万行 |
| CSVエクスポート | レポート用のデータ抽出 | 最大50万行 |
| 夜間バッチ | スケジュール済みの集計ジョブ | 可変 |
| メールバッチ | メール大量配信 | 最大5万受信者 |

### 3. ジョブステート

| ステート | 説明 |
|-------|-------------|
| QUEUED | キューで待機中のジョブ |
| PROCESSING | 現在実行中のジョブ |
| COMPLETED | 正常に完了したジョブ |
| FAILED | 失敗したジョブ（再試行される可能性）|
| CANCELLED | 手動でキャンセルされたジョブ |

### 4. CSVインポートフロー

1. ユーザーがCSVファイルをアップロード
2. ファイルを検証（フォーマット、サイズ、ヘッダー）
3. バックグラウンド処理用にジョブをキューに追加
4. バッチで行を処理（1バッチ1000行）
5. 結果サマリーを生成

## APIエンドポイント

| エンドポイント | メソッド | 説明 |
|----------|--------|-------------|
| /api/jobs | POST | 新しいジョブを作成 |
| /api/jobs/:id | GET | ジョブステータスを取得 |
| /api/jobs/:id/cancel | POST | キューに入っているジョブをキャンセル |
| /api/imports/csv | POST | インポート用のCSVをアップロード |
| /api/exports/csv | POST | CSVエクスポートをリクエスト |

## 設定

- 最大ファイルサイズ: 50MB
- 処理タイムアウト: ジョブあたり30分
- 最大並行ジョブ数: 10
- 再試行回数: 3
