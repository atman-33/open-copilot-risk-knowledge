# 決済ドメイン仕様

## 概要

このドメインは、クレジットカード処理、払い戻し、トランザクション管理を含むすべての決済関連機能をカバーしています。

## コアコンポーネント

### 1. 決済フロー

- ユーザーがチェックアウト時に決済方法を選択
- PSP（決済サービスプロバイダー）経由で決済詳細をトークン化
- バックエンドがトークン化データを使用して決済を開始
- トランザクション結果を保存し、オーダーステータスを更新

### 2. サポートされる決済方法

- クレジット/デビットカード（Visa、Mastercard、AMEX）
- 銀行振込
- デジタルウォレット（Apple Pay、Google Pay）

### 3. トランザクションステート

| ステート | 説明 |
|-------|-------------|
| PENDING | 決済が開始され、確認を待機中 |
| AUTHORIZED | 決済が認可されたが、未キャプチャ |
| CAPTURED | 決済が正常に完了 |
| FAILED | 決済が失敗 |
| REFUNDED | 決済が払い戻された（全額または一部）|

### 4. 払い戻し処理

- 全額払い戻し: トランザクション金額の100%
- 部分払い戻し: 元の金額まで設定可能な金額
- 払い戻し期限: 元のトランザクションから180日

## APIエンドポイント

| エンドポイント | メソッド | 説明 |
|----------|--------|-------------|
| /api/payments/initiate | POST | 決済プロセスを開始 |
| /api/payments/:id | GET | 決済ステータスを取得 |
| /api/payments/:id/capture | POST | 認可された決済をキャプチャ |
| /api/payments/:id/refund | POST | 払い戻しを開始 |

## 外部依存関係

- 決済サービスプロバイダー（PSP）API
- 不正検出サービス
- 会計システムウェブフック
