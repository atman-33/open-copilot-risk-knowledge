# 認証ドメイン仕様

## 概要

このドメインは、ログイン、ログアウト、セッション管理、パスワード処理を含むすべての認証関連機能をカバーしています。

## コアコンポーネント

### 1. ログインフロー

- ユーザーが認証情報（メール/パスワードまたはSSO）を送信
- バックエンドがユーザーストアに対して認証情報を検証
- 成功時: JWTアクセストークン + リフレッシュトークンを発行
- セッション情報をRedisに保存

### 2. トークン管理

- **アクセストークン**: 短寿命（15分）、API認証に使用
- **リフレッシュトークン**: 長寿命（7日間）、新しいアクセストークンを取得するために使用
- トークンはHTTP-onlyクッキーに保存

### 3. セッション管理

- Redisでユーザーメタデータとともにセッションを追跡
- 並行セッション制限: ユーザーロールごとに設定可能
- パスワード変更時のセッション無効化

### 4. SSO統合

- SAML 2.0およびOIDCプロトコルをサポート
- IdP初期化およびSP初期化フロー
- アトリビュートマッピング: メール、名前、ロール

## APIエンドポイント

| エンドポイント | メソッド | 説明 |
|----------|--------|-------------|
| /api/auth/login | POST | ユーザーログイン |
| /api/auth/logout | POST | ユーザーログアウト |
| /api/auth/refresh | POST | アクセストークンを更新 |
| /api/auth/me | GET | 現在のユーザー情報を取得 |

## 依存関係

- Redis: セッションストレージ
- PostgreSQL: ユーザー認証情報
- 外部IdP: SSO認証
